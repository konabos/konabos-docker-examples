<?xml version="1.0" encoding="utf-8" ?>
<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/patch" xmlns:role="http://www.sitecore.net/xmlconfig/role" >
<sitecore role:require="Standalone or ContentManagement">
    <eventing defaultProvider="sitecore">
        <eventQueueProvider>
            <eventQueue name="preview" patch:after="eventQueue[@name='web']" type="Sitecore.Data.Eventing.$(database)EventQueue, Sitecore.Kernel">
                <param ref="dataApis/dataApi[@name='$(database)']" param1="$(name)" />
                <param hint="" ref="PropertyStoreProvider/store[@name='$(name)']" />
            </eventQueue>
        </eventQueueProvider>
    </eventing>
    <PropertyStoreProvider>
        <store name="preview" patch:after="store[@name='web']" prefix="preview" getValueWithoutPrefix="true" singleInstance="true" type="Sitecore.Data.Properties.$(database)PropertyStore, Sitecore.Kernel">
            <param ref="dataApis/dataApi[@name='$(database)']" param1="$(name)" />
            <param resolve="true" type="Sitecore.Abstractions.BaseEventManager, Sitecore.Kernel" />
            <param resolve="true" type="Sitecore.Abstractions.BaseCacheManager, Sitecore.Kernel" />
        </store>
    </PropertyStoreProvider>
    <databases>
        <!-- preview -->
        <database id="preview" patch:after="database[@id='web']" singleInstance="true" type="Sitecore.Data.DefaultDatabase, Sitecore.Kernel">
            <param desc="name">$(id)</param>
            <icon>Images/database_web.png</icon>
            <securityEnabled>true</securityEnabled>
            <dataProviders hint="list:AddDataProvider">
                <dataProvider type="Sitecore.Data.DataProviders.CompositeDataProvider, Sitecore.Kernel">
                    <param desc="readOnlyDataProviders" hint="list">
                        <protobufItems type="Sitecore.Data.DataProviders.ReadOnly.Protobuf.ProtobufDataProvider, Sitecore.Kernel">
                            <filePaths hint="list">
                                <filePath>$(dataFolder)/items/$(id)</filePath>
                            </filePaths>
                        </protobufItems>
                    </param>
                    <param desc="headProvider">
                        <dataProvider ref="dataProviders/main" param1="$(id)">
                            <disableGroup>publishing</disableGroup>
                            <prefetch hint="raw:AddPrefetch">
                                <sc.include file="/App_Config/Prefetch/Common.config" />
                                <sc.include file="/App_Config/Prefetch/Webdb.config" />
                            </prefetch>
                        </dataProvider>
                    </param>
                </dataProvider>
            </dataProviders>
            <PropertyStore ref="PropertyStoreProvider/store[@name='$(id)']" />
            <remoteEvents.EventQueue>
                <obj ref="eventing/eventQueueProvider/eventQueue[@name='$(id)']" />
            </remoteEvents.EventQueue>
            <archives hint="raw:AddArchive">
                <archive name="archive" />
                <archive name="recyclebin" />
            </archives>
            <cacheSizes hint="setting">
                <data>100MB</data>
                <items>50MB</items>
                <paths>2500KB</paths>
                <itempaths>50MB</itempaths>
                <standardValues>2500KB</standardValues>
            </cacheSizes>
            <BlobStorage hint="raw:AddBlobStorage">
                <providers default="classic">
                    <provider name="classic" type="Sitecore.Data.Blobs.ClassicSqlBlobProvider, Sitecore.Kernel">
                        <param desc="databaseName">$(id)</param>
                    </provider>
                </providers>
            </BlobStorage>
            <Engines.DataEngine.Commands.AddFromTemplatePrototype patch:source="Sitecore.Buckets.config">
                <obj type="Sitecore.Buckets.Commands.AddFromTemplateCommand, Sitecore.Buckets"/>
            </Engines.DataEngine.Commands.AddFromTemplatePrototype>
        </database>
    </databases>
</sitecore>
</configuration>
